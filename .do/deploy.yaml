# DigitalOcean App Platform Specification
# Task Manager Application Deployment Configuration

name: task-manager-app-production
region: nyc

services:
  - name: web
    source_dir: /
    github:
      repo: RithishRamesh-dev/task-manager-app-autodev
      branch: staging
      deploy_on_push: true
    
    # Build configuration
    build_command: |
      pip install --upgrade pip
      pip install -r requirements.txt
      # Run database migrations
      flask db upgrade
    
    # Runtime configuration
    run_command: |
      gunicorn --worker-class eventlet -w 1 --bind 0.0.0.0:$PORT app_socketio:app
    
    # Service configuration
    instance_count: 1
    instance_size_slug: basic-xxs
    http_port: 8080
    
    # Health check configuration
    health_check:
      http_path: /api/health
      initial_delay_seconds: 30
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
    
    # Environment variables
    envs:
      - key: FLASK_APP
        value: app_socketio.py
      - key: FLASK_ENV
        value: production
      - key: ENVIRONMENT
        value: production
      - key: PORT
        value: "8080"
      - key: SECRET_KEY
        value: "prod-secret-key-2024-tm-app"
      - key: JWT_SECRET_KEY
        value: "jwt-secret-key-2024-tm-app-secure"
      - key: DEBUG
        value: "False"
      - key: DB_PRODUCTION
        value: "true"
      - key: WEBSOCKET_ENABLED
        value: "True"
      - key: EMAIL_NOTIFICATIONS_ENABLED
        value: "True"
      - key: REGISTRATION_ENABLED
        value: "True"
      - key: RATE_LIMIT_ENABLED
        value: "True"
      - key: RATE_LIMIT_PER_MINUTE
        value: "60"
      - key: SESSION_COOKIE_SECURE
        value: "True"
      - key: SESSION_COOKIE_HTTPONLY
        value: "True"
      - key: SESSION_COOKIE_SAMESITE
        value: "Lax"
      - key: LOG_LEVEL
        value: "INFO"
      - key: LOG_TO_STDOUT
        value: "True"
      - key: RESTX_MASK_SWAGGER
        value: "False"
      - key: RESTX_VALIDATE
        value: "True"
      - key: JWT_ACCESS_TOKEN_EXPIRES
        value: "3600"

databases:
  - name: db
    engine: PG
    version: "15"
    production: true
    
  - name: redis
    engine: REDIS
    version: "7"
    production: false